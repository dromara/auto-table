---
title: äº‹ä»¶å›è°ƒ
description: AutoTable äº‹ä»¶å›è°ƒæœºåˆ¶
---

# äº‹ä»¶å›è°ƒ

AutoTable åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æä¾›äº†ä¸°å¯Œçš„å›è°ƒæ¥å£ï¼Œæ–¹ä¾¿ç›‘å¬è¡¨çš„åˆ›å»ºã€ä¿®æ”¹ç­‰äº‹ä»¶ã€‚

## å›è°ƒå…¨æ™¯

```mermaid
flowchart TB
    subgraph lifecycle["ğŸ”” ç”Ÿå‘½å‘¨æœŸå›è°ƒ"]
        direction TB
        
        START["ğŸš€ å¯åŠ¨"]
        
        START --> R1
        subgraph R1["ReadyCallback"]
            R1_DESC["é…ç½®å°±ç»ª"]
        end
        
        R1 --> DB_CHECK{"è‡ªåŠ¨å»ºåº“?"}
        DB_CHECK -->|"æ˜¯"| R2
        subgraph R2["CreateDatabaseFinishCallback"]
            R2_DESC["å»ºåº“å®Œæˆ"]
        end
        R2 --> LOOP
        DB_CHECK -->|"å¦"| LOOP
        
        LOOP["ğŸ”„ éå†å®ä½“"]
        
        LOOP --> RB
        subgraph RB["RunBeforeCallback"]
            RB_DESC["å•è¡¨æ‰§è¡Œå‰"]
        end
        
        RB --> MODE{"è¿è¡Œæ¨¡å¼?"}
        
        MODE -->|"validate"| VAL
        subgraph VAL["ValidateFinishCallback"]
            VAL_DESC["æ ¡éªŒå®Œæˆ"]
        end
        
        MODE -->|"create"| DEL
        subgraph DEL["DeleteTableFinishCallback"]
            DEL_DESC["åˆ è¡¨å®Œæˆ"]
        end
        DEL --> R3
        
        MODE -->|"update è¡¨ä¸å­˜åœ¨"| R3
        subgraph R3["CreateTableFinishCallback"]
            R3_DESC["å»ºè¡¨å®Œæˆ"]
        end
        
        MODE -->|"update è¡¨å­˜åœ¨"| CMP
        subgraph CMP["CompareTableFinishCallback"]
            CMP_DESC["æ¯”å¯¹å®Œæˆ"]
        end
        CMP --> MODIFY
        subgraph MODIFY["ModifyTableFinishCallback"]
            M_DESC["æ”¹è¡¨å®Œæˆ"]
        end
        
        VAL & R3 & MODIFY --> RA
        
        subgraph RA["RunAfterCallback"]
            RA_DESC["å•è¡¨æ‰§è¡Œå"]
        end
        
        RA --> NEXT{"è¿˜æœ‰å®ä½“?"}
        NEXT -->|"æ˜¯"| LOOP
        NEXT -->|"å¦"| R7
        
        subgraph R7["FinishCallback"]
            R7_DESC["å…¨éƒ¨å®Œæˆ"]
        end
    end

    style R1 fill:#dbeafe,stroke:#3b82f6
    style R2 fill:#d1fae5,stroke:#10b981
    style RB fill:#e0e7ff,stroke:#6366f1
    style VAL fill:#fef3c7,stroke:#f59e0b
    style DEL fill:#fee2e2,stroke:#ef4444
    style R3 fill:#d1fae5,stroke:#10b981
    style CMP fill:#f0f9ff,stroke:#0ea5e9
    style MODIFY fill:#fef3c7,stroke:#f59e0b
    style RA fill:#e0e7ff,stroke:#6366f1
    style R7 fill:#fce7f3,stroke:#ec4899
```

## å›è°ƒåˆ—è¡¨

| å›è°ƒ | è§¦å‘æ—¶æœº | è¯´æ˜ |
|------|----------|------|
| `AutoTableReadyCallback` | é…ç½®å°±ç»ªå | å¯åšè‡ªå®šä¹‰åˆå§‹åŒ– |
| `CreateDatabaseFinishCallback` | å»ºåº“å | è‡ªåŠ¨å»ºåº“å¼€å¯æ—¶ |
| `RunBeforeCallback` | å•è¡¨æ‰§è¡Œå‰ | æ¯ä¸ªè¡¨æ‰§è¡Œå‰è§¦å‘ |
| `ValidateFinishCallback` | æ ¡éªŒå | validate æ¨¡å¼ |
| `DeleteTableFinishCallback` | åˆ è¡¨å | create æ¨¡å¼åˆ è¡¨ |
| `CreateTableFinishCallback` | å»ºè¡¨å | æ–°è¡¨åˆ›å»ºå®Œæˆ |
| `CompareTableFinishCallback` | æ¯”å¯¹å | è¡¨ç»“æ„æ¯”å¯¹å®Œæˆ |
| `ModifyTableFinishCallback` | æ”¹è¡¨å | è¡¨ç»“æ„å˜æ›´å®Œæˆ |
| `RunAfterCallback` | å•è¡¨æ‰§è¡Œå | æ¯ä¸ªè¡¨æ‰§è¡Œåè§¦å‘ |
| `AutoTableFinishCallback` | å…¨éƒ¨å®Œæˆ | æ‰€æœ‰è¡¨å¤„ç†å®Œæˆ |

## AutoTableReadyCallback

é…ç½®å·²ç»æ³¨å…¥å®Œæˆï¼Œå‡†å¤‡æ‰§è¡Œå‰çš„å›è°ƒã€‚

```mermaid
flowchart LR
    A["ğŸ“¦ é…ç½®åŠ è½½"] --> B["ğŸ”§ Readyå›è°ƒ"]
    B --> C["ğŸš€ å¼€å§‹æ‰§è¡Œ"]

    style B fill:#3b82f6,stroke:#2563eb,color:#fff
```

```java
public interface AutoTableReadyCallback {
    void ready(final Set<Class<?>> tableClasses);
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šè‡ªå®šä¹‰é…ç½®åˆå§‹åŒ–ã€é¢„å¤„ç†å®ä½“é›†åˆã€æ—¥å¿—è®°å½•

## CreateDatabaseFinishCallback

è‡ªåŠ¨å»ºåº“å®Œæˆåçš„å›è°ƒã€‚

```java
@FunctionalInterface
public interface CreateDatabaseFinishCallback {
    void afterCreateDatabase(String dataSource, Set<Class<?>> classes, 
                             DataSourceInfoExtractor.DbInfo dbInfo);
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šå»ºåº“åæ‰§è¡Œåˆå§‹åŒ–è„šæœ¬

## RunBeforeCallback / RunAfterCallback

å•ä¸ªè¡¨æ‰§è¡Œå‰åçš„å›è°ƒã€‚

```mermaid
flowchart LR
    A["RunBefore"] --> B["å¤„ç†è¡¨"] --> C["RunAfter"]

    style A fill:#6366f1,stroke:#4f46e5,color:#fff
    style C fill:#6366f1,stroke:#4f46e5,color:#fff
```

```java
public interface RunBeforeCallback {
    void before(final Class<?> tableClass);
}

public interface RunAfterCallback {
    void after(final Class<?> tableClass);
}
```

## CreateTableFinishCallback

å»ºè¡¨å®Œæˆåçš„å›è°ƒã€‚

```mermaid
flowchart LR
    A["ğŸ“ CREATE TABLE"] --> B["ğŸ”” å»ºè¡¨å›è°ƒ"]
    B --> C["ğŸ“¦ åˆå§‹åŒ–æ•°æ®"]

    style B fill:#10b981,stroke:#059669,color:#fff
```

```java
@FunctionalInterface
public interface CreateTableFinishCallback {
    void afterCreateTable(String databaseDialect, final TableMetadata tableMetadata);
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šåˆå§‹åŒ–è¡¨æ•°æ®ã€è®°å½•å»ºè¡¨æ—¥å¿—ã€è§¦å‘åç»­ä¸šåŠ¡

## CompareTableFinishCallback

è¡¨ç»“æ„æ¯”å¯¹å®Œæˆåçš„å›è°ƒï¼ˆupdate æ¨¡å¼ä¸‹è§¦å‘ï¼‰ã€‚

```java
@FunctionalInterface
public interface CompareTableFinishCallback {
    void afterCompareTable(String databaseDialect, 
                           final TableMetadata tableMetadata, 
                           final CompareTableInfo compareTableInfo);
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šè®°å½•ç»“æ„å·®å¼‚ã€è‡ªå®šä¹‰å˜æ›´å®¡æ‰¹

## ModifyTableFinishCallback

ä¿®æ”¹è¡¨å®Œæˆåçš„å›è°ƒã€‚

```mermaid
flowchart LR
    A["âœï¸ ALTER TABLE"] --> B["ğŸ”” æ”¹è¡¨å›è°ƒ"]
    B --> C["ğŸ“‹ è®°å½•å˜æ›´"]

    style B fill:#f59e0b,stroke:#d97706,color:#fff
```

```java
@FunctionalInterface
public interface ModifyTableFinishCallback {
    void afterModifyTable(String databaseDialect, 
                          final TableMetadata tableMetadata, 
                          final CompareTableInfo compareTableInfo);
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šè®°å½•å˜æ›´å†å²ã€å‘é€å˜æ›´é€šçŸ¥ã€æ•°æ®è¿ç§»

## DeleteTableFinishCallback

åˆ é™¤è¡¨å®Œæˆåçš„å›è°ƒï¼ˆcreate æ¨¡å¼ä¸‹è§¦å‘ï¼‰ã€‚

```java
@FunctionalInterface
public interface DeleteTableFinishCallback {
    void afterDeleteTables(String schema, final String tableName);
}
```

## ValidateFinishCallback

éªŒè¯æ¨¡å¼ä¸‹ï¼ŒéªŒè¯å®Œæˆåçš„å›è°ƒã€‚

```mermaid
flowchart LR
    A["ğŸ” æ¯”å¯¹ç»“æ„"] --> B["ğŸ”” éªŒè¯å›è°ƒ"]
    B --> C{"ç»“æœ"}
    C -->|"é€šè¿‡"| D["âœ… ç»§ç»­"]
    C -->|"å¤±è´¥"| E["âŒ å¼‚å¸¸"]

    style B fill:#6366f1,stroke:#4f46e5,color:#fff
```

```java
@FunctionalInterface
public interface ValidateFinishCallback {
    void validateFinish(boolean status, String databaseDialect, 
                        final CompareTableInfo compareTableInfo);
}
```

## AutoTableFinishCallback

å…¨éƒ¨æ‰§è¡Œå®Œæˆåçš„å›è°ƒã€‚

```mermaid
flowchart LR
    A["âš™ï¸ å¤„ç†æ‰€æœ‰è¡¨"] --> B["ğŸ”” å®Œæˆå›è°ƒ"]
    B --> C["ğŸ‰ ç»“æŸ"]

    style B fill:#ec4899,stroke:#db2777,color:#fff
```

```java
public interface AutoTableFinishCallback {
    void finish(final Set<Class<?>> tableClasses);
}
```

**ä½¿ç”¨åœºæ™¯**ï¼šæ¸…ç†ä¸´æ—¶èµ„æºã€ç»Ÿè®¡æ‰§è¡Œç»“æœã€è§¦å‘åç»­åˆå§‹åŒ–

## ä½¿ç”¨ç¤ºä¾‹

### Spring Boot

```java
@Component
public class MyTableCallback implements CreateTableFinishCallback {
    
    @Override
    public void afterCreateTable(String databaseDialect, 
                                  TableMetadata tableMetadata) {
        log.info("è¡¨ {} åˆ›å»ºå®Œæˆ", tableMetadata.getTableName());
    }
}
```

### æ™®é€š Java

```java
AutoTableGlobalConfig.instance().getCreateTableFinishCallbacks()
    .add((dialect, metadata) -> {
        System.out.println("è¡¨ " + metadata.getTableName() + " åˆ›å»ºå®Œæˆ");
    });
```

## ä¸‹ä¸€æ­¥

- äº†è§£ [æ‹¦æˆªå™¨](/é«˜çº§åŠŸèƒ½/æ‹¦æˆªå™¨) æœºåˆ¶
- æŸ¥çœ‹ [å·¥ä½œåŸç†](/æ ¸å¿ƒæ¦‚å¿µ/å·¥ä½œåŸç†) å®Œæ•´æµç¨‹
