---
title: æ‹¦æˆªå™¨
description: AutoTable æ‹¦æˆªå™¨è¯¦è§£
---

# æ‹¦æˆªå™¨

AutoTable æ‰§è¡Œè¿‡ç¨‹ä¸­æä¾›äº†å¤šä¸ªé’©å­ï¼Œæ–¹ä¾¿æ‹¦æˆªç”šè‡³ä¿®æ”¹è¿‡ç¨‹ä¸­çš„ä¿¡æ¯ã€‚

## æ‹¦æˆªå™¨å…¨æ™¯

```mermaid
flowchart TD
    subgraph flow["ğŸ”„ AutoTable æ‰§è¡Œæµç¨‹"]
        direction TB
        
        subgraph I1["ğŸ·ï¸ AnnotationInterceptor"]
            I1_DESC["ä¿®æ”¹æ‰«ææ³¨è§£é›†åˆ"]
        end
        
        I1 --> A["ğŸ“¦ æ‰«æå®ä½“"]
        A --> B["ğŸ“ è§£ææ³¨è§£"]
        B --> C["ğŸ—ï¸ æ„å»ºè¡¨å…ƒæ•°æ®"]
        C --> I2
        
        subgraph I2["ğŸ”§ MetadataInterceptor"]
            I2_DESC["ä¿®æ”¹è¡¨å…ƒæ•°æ®"]
        end
        
        I2 --> MODE{"è¿è¡Œæ¨¡å¼"}
        
        MODE -->|"create æˆ– update è¡¨ä¸å­˜åœ¨"| I3
        subgraph I3["â• CreateInterceptor"]
            I3_DESC["å»ºè¡¨å‰æ‹¦æˆª"]
        end
        I3 --> E["æ‰§è¡Œ CREATE"]
        
        MODE -->|"update è¡¨å­˜åœ¨"| F["æ¯”å¯¹å·®å¼‚"]
        F --> I4
        subgraph I4["âœï¸ ModifyInterceptor"]
            I4_DESC["æ”¹è¡¨å‰æ‹¦æˆª"]
        end
        I4 --> G["æ‰§è¡Œ ALTER"]
    end

    style I1 fill:#dbeafe,stroke:#3b82f6
    style I2 fill:#d1fae5,stroke:#10b981
    style I3 fill:#fef3c7,stroke:#f59e0b
    style I4 fill:#fce7f3,stroke:#ec4899
```

## æ‹¦æˆªå™¨åˆ—è¡¨

| æ‹¦æˆªå™¨ | è§¦å‘æ—¶æœº | ç”¨é€” |
|--------|----------|------|
| `AutoTableAnnotationInterceptor` | æ‰«æå®ä½“å‰ | ä¿®æ”¹è¦æ‰«æçš„æ³¨è§£é›†åˆ |
| `BuildTableMetadataInterceptor` | å…ƒæ•°æ®æ„å»ºå | ä¿®æ”¹è¡¨/å­—æ®µä¿¡æ¯ |
| `CreateTableInterceptor` | CREATE æ‰§è¡Œå‰ | å»ºè¡¨å‰è‡ªå®šä¹‰å¤„ç† |
| `ModifyTableInterceptor` | ALTER æ‰§è¡Œå‰ | æ”¹è¡¨å‰è‡ªå®šä¹‰å¤„ç† |

## AutoTableAnnotationInterceptor

ä¿®æ”¹éœ€è¦è¢«æ‰«æçš„æ³¨è§£é›†åˆï¼Œè¿›è€Œæ”¹å˜è‡ªåŠ¨å»ºè¡¨çš„å®ä½“é›†åˆã€‚

**è§¦å‘æ—¶æœº**ï¼šåœ¨æ‰«æå®ä½“ç±»ä¹‹å‰

```mermaid
flowchart LR
    subgraph before["é»˜è®¤æ³¨è§£"]
        A1["@AutoTable"]
    end
    
    INT["ğŸ”§ æ‹¦æˆªå™¨"]
    
    subgraph after["ä¿®æ”¹å"]
        B1["@AutoTable"]
        B2["@CustomTable"]
    end
    
    before --> INT --> after

    style INT fill:#6366f1,stroke:#4f46e5,color:#fff
```

### æ¥å£å®šä¹‰

```java
@FunctionalInterface
public interface AutoTableAnnotationInterceptor {
    /**
     * åŒ…å«å’Œæ’æ–¥å–äº¤é›†ï¼Œå³ï¼šå¦‚æœæ—¢åŒ…å«åˆæ’æ–¥ï¼Œåˆ™ä¼šæ’é™¤
     */
    void intercept(Set<Class<? extends Annotation>> includeAnnotations, 
                   Set<Class<? extends Annotation>> excludeAnnotations);
}
```

### ä½¿ç”¨ç¤ºä¾‹

```java
@Component
public class MyAnnotationInterceptor implements AutoTableAnnotationInterceptor {
    
    @Override
    public void intercept(Set<Class<? extends Annotation>> include,
                          Set<Class<? extends Annotation>> exclude) {
        // æ·»åŠ è‡ªå®šä¹‰æ³¨è§£åˆ°æ‰«æåˆ—è¡¨
        include.add(MyCustomTable.class);
        // æ’é™¤æŸäº›æ³¨è§£
        exclude.add(IgnoreTable.class);
    }
}
```

## BuildTableMetadataInterceptor

æ‹¦æˆªä¿®æ”¹è¡¨ä¿¡æ¯ï¼Œæ¯”å¦‚å¯¹è¡¨åŠå­—æ®µçš„æ³¨é‡Šè¿›è¡Œå›½é™…åŒ–ã€‚

**è§¦å‘æ—¶æœº**ï¼šæ¯ä¸ªè¡¨å…ƒæ•°æ®æ„å»ºå®Œæˆåï¼Œæ‰§è¡Œ SQL ä¹‹å‰

```mermaid
flowchart LR
    A["ğŸ“‹ åŸå§‹å…ƒæ•°æ®"] --> B["ğŸ”§ æ‹¦æˆªå™¨"]
    B --> C["ğŸ“‹ ä¿®æ”¹å"]

    style B fill:#6366f1,stroke:#4f46e5,color:#fff
```

### æ¥å£å®šä¹‰

```java
@FunctionalInterface
public interface BuildTableMetadataInterceptor {
    /**
     * @param databaseDialect æ•°æ®åº“æ–¹è¨€ï¼šMySQLã€PostgreSQLã€SQLite ç­‰
     * @param tableMetadata   è¡¨å…ƒæ•°æ®
     */
    void intercept(final String databaseDialect, final TableMetadata tableMetadata);
}
```

### ä½¿ç”¨ç¤ºä¾‹

```java
@Component
public class I18nInterceptor implements BuildTableMetadataInterceptor {
    
    public void intercept(final String databaseDialect, final TableMetadata tableMetadata) {
        if (DatabaseDialect.MYSQL.equals(databaseDialect)) {
            MysqlTableMetadata meta = (MysqlTableMetadata) tableMetadata;
            // ä¿®æ”¹è¡¨æ³¨é‡Šä¸ºå›½é™…åŒ–å†…å®¹
            meta.setComment(i18n(meta.getComment()));
        }
    }
}
```

::: tip æ³¨å…¥æ–¹å¼
- **Spring Boot**ï¼šä½¿ç”¨ `@Component` æ³¨è§£è‡ªåŠ¨æ³¨å…¥
- **æ™®é€š Java**ï¼š`AutoTableGlobalConfig.instance().getBuildTableMetadataInterceptors().add(...)`
:::

## CreateTableInterceptor

åœ¨ç¡®å®šè¦æ‰§è¡Œå»ºè¡¨å‰è¿›è¡Œæ‹¦æˆªï¼Œå¯ä»¥ä¿®æ”¹ä¿¡æ¯å½±å“å»ºè¡¨é€»è¾‘ã€‚

**è§¦å‘æ—¶æœº**ï¼šCREATE TABLE SQL æ‰§è¡Œä¹‹å‰

```mermaid
flowchart LR
    A["ğŸ“‹ è¡¨å…ƒæ•°æ®"] --> B["ğŸ”§ æ‹¦æˆª"]
    B --> C["ğŸ“ CREATE TABLE"]

    style B fill:#f59e0b,stroke:#d97706,color:#fff
```

### æ¥å£å®šä¹‰

```java
@FunctionalInterface
public interface CreateTableInterceptor {
    void beforeCreateTable(String databaseDialect, final TableMetadata tableMetadata);
}
```

### ä½¿ç”¨ç¤ºä¾‹

```java
@Component
public class MyCreateInterceptor implements CreateTableInterceptor {
    
    @Override
    public void beforeCreateTable(String dialect, TableMetadata metadata) {
        log.info("å³å°†åˆ›å»ºè¡¨: {}", metadata.getTableName());
    }
}
```

## ModifyTableInterceptor

åœ¨ç¡®å®šè¦æ‰§è¡Œæ”¹è¡¨å‰è¿›è¡Œæ‹¦æˆªï¼Œå¯ä»¥ä¿®æ”¹ä¿¡æ¯å½±å“æ”¹è¡¨é€»è¾‘ã€‚

**è§¦å‘æ—¶æœº**ï¼šè¡¨ç»“æ„æ¯”å¯¹å®Œæˆåï¼ŒALTER TABLE SQL æ‰§è¡Œä¹‹å‰

```mermaid
flowchart LR
    A["ğŸ“‹ å…ƒæ•°æ®"] --> B["ğŸ” æ¯”å¯¹"]
    B --> C["ğŸ”§ æ‹¦æˆª"]
    C --> D["ğŸ“ ALTER"]

    style C fill:#ec4899,stroke:#db2777,color:#fff
```

### æ¥å£å®šä¹‰

```java
@FunctionalInterface
public interface ModifyTableInterceptor {
    void beforeModifyTable(String databaseDialect, 
                           final TableMetadata tableMetadata, 
                           final CompareTableInfo compareTableInfo);
}
```

### ä½¿ç”¨ç¤ºä¾‹

```java
@Component
public class MyModifyInterceptor implements ModifyTableInterceptor {
    
    @Override
    public void beforeModifyTable(String dialect, 
                                   TableMetadata metadata,
                                   CompareTableInfo compareInfo) {
        // å¯ä»¥æŸ¥çœ‹ compareInfo ä¸­çš„å·®å¼‚ä¿¡æ¯
        log.info("å³å°†ä¿®æ”¹è¡¨: {}, å·®å¼‚: {}", 
                 metadata.getTableName(), 
                 compareInfo.needModify());
    }
}
```

## æ³¨å†Œæ–¹å¼

```mermaid
flowchart TB
    subgraph spring["ğŸƒ Spring Boot"]
        S1["@Component"]
        S2["è‡ªåŠ¨æ³¨å…¥"]
    end
    
    subgraph java["â˜• æ™®é€š Java"]
        J1["AutoTableGlobalConfig"]
        J2[".getXxxInterceptors().add()"]
    end

    style spring fill:#d1fae5,stroke:#10b981
    style java fill:#fef3c7,stroke:#f59e0b
```

### Spring Boot

```java
@Component
public class MyInterceptor implements BuildTableMetadataInterceptor {
    // è‡ªåŠ¨æ³¨å…¥
}
```

### æ™®é€š Java

```java
// è·å–å®ä¾‹å¹¶æ·»åŠ æ‹¦æˆªå™¨
AutoTableGlobalConfig config = AutoTableGlobalConfig.instance();

config.getAutoTableAnnotationInterceptors().add(new MyAnnotationInterceptor());
config.getBuildTableMetadataInterceptors().add(new MyMetadataInterceptor());
config.getCreateTableInterceptors().add(new MyCreateInterceptor());
config.getModifyTableInterceptors().add(new MyModifyInterceptor());
```

## ä¸‹ä¸€æ­¥

- äº†è§£ [äº‹ä»¶å›è°ƒ](/é«˜çº§åŠŸèƒ½/äº‹ä»¶å›è°ƒ) æœºåˆ¶
- æŸ¥çœ‹ [å·¥ä½œåŸç†](/æ ¸å¿ƒæ¦‚å¿µ/å·¥ä½œåŸç†) äº†è§£å®Œæ•´æ‰§è¡Œæµç¨‹
