import{_ as i,c as a,a2 as n,o as l}from"./chunks/framework.DVcYaelC.js";const E=JSON.parse('{"title":"开发/生产环境","description":null,"frontmatter":{"title":"开发/生产环境","description":null},"headers":[],"relativePath":"指南/高级/开发生产环境.md","filePath":"指南/高级/开发生产环境.md","lastUpdated":1731512067000}'),e={name:"指南/高级/开发生产环境.md"};function p(t,s,h,k,r,d){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="开发-生产环境" tabindex="-1">开发/生产环境 <a class="header-anchor" href="#开发-生产环境" aria-label="Permalink to &quot;开发/生产环境&quot;">​</a></h1><p>我们日常开发中，会遇到一个问题：生产环境无法通过程序对表结构做自动维护。</p><p>原因有很多，数据库账号没有DDL权限、上线流程要求数据库的改动必须走审批、等等......</p><p>所以最佳实践方案是：</p><p>1、开发环境开启AutoTable，AutoTable运行过程中，自动记录实体变更过程中产生的SQL。</p><p>2、然后生产环境关闭AutoTable，上线前研发人员将开发环境中AutoTable记录的SQL递交审批（可自行实现AutoTable的SQL记录接口，自定义记录方案，比如直接对接内部的SQL审计平台）。</p><p>3、SQL审批通过，走上线流程。</p><h2 id="spring-boot-应用" tabindex="-1">spring boot 应用 <a class="header-anchor" href="#spring-boot-应用" aria-label="Permalink to &quot;spring boot 应用&quot;">​</a></h2><h3 id="开发环境" tabindex="-1">开发环境 <a class="header-anchor" href="#开发环境" aria-label="Permalink to &quot;开发环境&quot;">​</a></h3><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-5WnYZ" id="tab-HbDYbBT" checked="checked"><label for="tab-HbDYbBT">SQL记录到数据库</label><input type="radio" name="group-5WnYZ" id="tab-TXdVPrp"><label for="tab-TXdVPrp">SQL记录到文件</label></div><div class="blocks"><div class="language-yaml vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发环境 application-dev.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">auto-table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 开启自动建表</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  record-sql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 开启SQL记录</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 当前版本（此处可保持与计划上线的版本号一致，方便管理SQL文件）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 记录到数据库（如果是多数据源，则会根据不同数据源，记录到不同的库）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    record-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db</span></span></code></pre></div><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开发环境 application-dev.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">auto-table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 开启自动建表</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  record-sql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 开启SQL记录</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 当前版本（此处可保持与计划上线的版本号一致，方便管理SQL文件）</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0.0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 记录到文件</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    record-type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">file</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 文件夹位置</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    folder-path</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/Users/don/Downloads/sqlLogs</span></span></code></pre></div><p>完整配置及介绍见<a href="/配置.html#recordsql">recordSql</a>配置</p></div></div><h3 id="生产环境" tabindex="-1">生产环境 <a class="header-anchor" href="#生产环境" aria-label="Permalink to &quot;生产环境&quot;">​</a></h3><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生产环境 application-prod.yml，关闭自动建表</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">auto-table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">  enable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span></span></code></pre></div><h2 id="普通-java-应用" tabindex="-1">普通 java 应用 <a class="header-anchor" href="#普通-java-应用" aria-label="Permalink to &quot;普通 java 应用&quot;">​</a></h2><h3 id="开发环境-1" tabindex="-1">开发环境 <a class="header-anchor" href="#开发环境-1" aria-label="Permalink to &quot;开发环境&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 配置信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AutoTableGlobalConfig.PropertyConfig autoTableProperties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AutoTableGlobalConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PropertyConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 开发环境 启用</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">autoTableProperties.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 记录sql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">PropertyConfig.RecordSqlProperties recordSqlProperties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> PropertyConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">RecordSqlProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">recordSqlProperties.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">recordSqlProperties.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRecordType</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(PropertyConfig.RecordSqlProperties.TypeEnum.db);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">recordSqlProperties.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setVersion</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0.0&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">autoTableProperties.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setRecordSql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(recordSqlProperties);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AutoTableGlobalConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAutoTableProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(autoTableProperties);</span></span></code></pre></div><h3 id="生产环境-1" tabindex="-1">生产环境 <a class="header-anchor" href="#生产环境-1" aria-label="Permalink to &quot;生产环境&quot;">​</a></h3><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 配置信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AutoTableGlobalConfig.PropertyConfig autoTableProperties </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AutoTableGlobalConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">PropertyConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 生产环境 关闭</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">autoTableProperties.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setEnable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">AutoTableGlobalConfig.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setAutoTableProperties</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(autoTableProperties);</span></span></code></pre></div>`,17)]))}const g=i(e,[["render",p]]);export{E as __pageData,g as default};
